<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - KPS United</title>
    <link rel="stylesheet" href="admin.css?v=1.2">
</head>

<body>
    <div class="login-container" id="admin-login">
        <div class="logo">
            <img src="logo.png" alt="KPS United" class="logo-image">
            <h1>üîê Admin Access</h1>
            <p>KPS United - Store Owner Management</p>
        </div>

        <div id="error-message" class="error-message"></div>

        <form onsubmit="handleAdminLogin(event)">
            <div class="form-group">
                <label for="admin-password">Admin Password</label>
                <input type="password" id="admin-password" placeholder="Enter admin password" required>
            </div>

            <button type="submit" class="btn">Access Admin Dashboard</button>
        </form>

        <p style="text-align: center; margin-top: 1.5rem; color: #666; font-size: 0.9rem;">
            Default password: <strong>admin123</strong><br>
            (Change this in the code!)<br>
            <small>v1.2</small>
        </p>
    </div>

    <!-- ADD PROMOTION MODAL -->
    <div id="addPromoModal" class="modal"
        style="display:none; position:fixed; z-index:1; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
        <div class="modal-content"
            style="background-color:#fefefe; margin:10% auto; padding:20px; border:1px solid #888; width:50%; border-radius:10px;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2>Add New Promotion</h2>
                <span onclick="document.getElementById('addPromoModal').style.display='none'"
                    style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addPromoForm" onsubmit="savePromo(event)">
                    <div class="form-group">
                        <label>Promotion Title</label>
                        <input type="text" id="promoTitle" required
                            style="width:100%; padding:10px; margin-bottom:10px;">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="promoDesc" rows="3"
                            style="width:100%; padding:10px; margin-bottom:10px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Linked Vendor</label>
                        <select id="promoVendor" required style="width:100%; padding:10px; margin-bottom:10px;">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Image (Optional)</label>
                        <input type="file" id="promoImage" accept="image/*" onchange="handlePromoImage(this)">
                        <input type="hidden" id="promoImageData">
                        <div id="promoImagePreview" style="margin-top:10px; max-width:100px;"></div>
                    </div>
                    <button type="submit" class="btn" style="width:100%;">Create Promotion</button>
                </form>
            </div>
        </div>
    </div>
    <div class="admin-container" id="admin-dashboard">
        <div class="admin-header">
            <div class="admin-header-left">
                <img src="logo.png" alt="KPS United" class="admin-logo">
                <h1>Admin Dashboard</h1>
            </div>
            <button class="btn-danger" onclick="handleLogout()">Logout</button>
        </div>

        <div class="tab-nav">
            <button class="active" onclick="switchTab('stores')">üè™ Registered Stores</button>
            <button onclick="switchTab('vendors')">üè¢ Vendors</button>
            <button onclick="switchTab('queries')">üí¨ Store Queries</button>
            <button onclick="switchTab('vendor-comm')">üìû Vendor Comm</button>
            <button onclick="switchTab('documents')">üìÇ Documents</button>
            <button onclick="switchTab('terms')">üìú Terms</button>
            <button onclick="switchTab('promotions')">üè∑Ô∏è Promotions</button>
            <button onclick="switchTab('reporting')">üìä Reporting</button>
        </div>

        <!-- STORES TAB -->
        <link rel="stylesheet" href="style.css?v=1.3">
        <div id="tab-stores" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-stores">0</div>
                    <div class="stat-label">Total Stores</div>
                </div>

                <div class="stat-card">
                    <div class="stat-number" id="active-stores">0</div>
                    <div class="stat-label">Active Stores</div>
                </div>

                <div class="stat-card">
                    <div class="stat-number" id="retail-stores">0</div>
                    <div class="stat-label">Retail Stores</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="downloadCSV()">üì• Download CSV</button>
                <button class="btn btn-secondary" onclick="downloadJSON()">üì• Download JSON</button>
                <button class="btn btn-secondary" onclick="copyEmails()">üìß Copy Store Emails</button>
            </div>

            <input type="text" class="search-box" id="search-box"
                placeholder="üîç Search by store name, phone or email..." onkeyup="filterStores()">

            <div style="overflow-x: auto;">
                <table class="users-table" id="users-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Member ID</th>
                            <th>Store ID</th>
                            <th>Store Name</th>
                            <th>Store Phone Number</th>
                            <th>Store Email</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <tr>
                            <td colspan="7" class="no-users">No stores registered yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VENDORS TAB -->
        <div id="tab-vendors" class="tab-content">
            <div class="admin-header" style="border-bottom: none; margin-bottom: 1rem;">
                <h2>Manage Vendors</h2>
                <button class="btn" style="width: auto;" onclick="openVendorModal()">+ Add New Vendor</button>
            </div>

            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Vendor Name</th>
                            <th>Pricing Info / URL</th>
                            <th>Contact Info</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendors-table-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- QUERIES TAB -->
        <div id="tab-queries" class="tab-content">
            <h2>Store Queries</h2>
            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Store</th>
                            <th>Subject</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="queries-table-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VENDOR COMM TAB -->
        <div id="tab-vendor-comm" class="tab-content">
            <div class="admin-header" style="border-bottom: none; margin-bottom: 1rem;">
                <h2>Vendor Communication Log</h2>
                <button class="btn" style="width: auto;" onclick="openCommModal()">+ Log Communication</button>
            </div>
            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Vendor</th>
                            <th>Type</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="comm-table-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DOCUMENTS TAB -->
        <div id="tab-documents" class="tab-content">
            <div class="admin-header" style="border-bottom: none; margin-bottom: 1rem;">
                <h2>Admin Documents</h2>
                <button class="btn" style="width: auto;" onclick="document.getElementById('doc-upload').click()">+
                    Upload Document</button>
                <input type="file" id="doc-upload" style="display: none;" onchange="handleDocUpload(this)">
            </div>
            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Document Name</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="docs-table-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TERMS TAB -->
        <div id="tab-terms" class="tab-content">
            <div class="admin-header" style="border-bottom: none; margin-bottom: 1rem;">
                <h2>Manage Terms & Conditions</h2>
                <button class="btn" style="width: auto;" onclick="publishTerms()">Publish New Version</button>
            </div>
            <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div class="form-group">
                    <label>Current Version: <span id="terms-version">Loading...</span></label>
                    <label>Last Updated: <span id="terms-date">Loading...</span></label>
                </div>
                <div class="form-group">
                    <label>Terms Content</label>
                    <textarea id="terms-content" rows="20"
                        style="width:100%; padding:15px; border-radius:5px; border:1px solid #ccc; font-family: monospace;"></textarea>
                </div>
            </div>
        </div>

        <!-- PROMOTIONS TAB -->
        <div id="tab-promotions" class="tab-content">
            <div class="admin-header" style="border-bottom: none; margin-bottom: 1rem;">
                <h2>Manage Promotions</h2>
                <button class="btn" style="width: auto;" onclick="openAddPromoModal()">+ Add Promotion</button>
            </div>
            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Vendor</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="promos-table-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- REPORTING TAB -->
        <div id="tab-reporting" class="tab-content">
            <div class="report-filters">
                <div>
                    <label>Filter by Town</label>
                    <select id="report-town">
                        <option value="">All Towns</option>
                    </select>
                </div>
                <div>
                    <label>Filter by Vendors</label>
                    <div class="multi-select-container" id="report-vendors">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div style="display: flex; align-items: flex-end;">
                    <button class="btn" onclick="generateReport()">Generate Report</button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="downloadReportCSV()">üì• Download Report CSV</button>
            </div>

            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Store Name</th>
                            <th>City</th>
                            <th>Vendors</th>
                            <th>Contact</th>
                        </tr>
                    </thead>
                    <tbody id="report-table-body">
                        <tr>
                            <td colspan="5" class="no-users">Select filters and click Generate Report</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Add Vendor Modal -->
    <div id="addVendorModal" class="modal"
        style="display:none; position:fixed; z-index:1; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
        <div class="modal-content"
            style="background-color:#fefefe; margin:15% auto; padding:20px; border:1px solid #888; width:50%; border-radius:10px;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 id="vendorModalTitle">Add New Vendor</h2>
                <span onclick="closeVendorModal()"
                    style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addVendorForm" onsubmit="saveVendor(event)">
                    <input type="hidden" id="vendorId">
                    <div class="form-group">
                        <label>Vendor Name *</label>
                        <input type="text" id="vendorName" required>
                    </div>
                    <div class="form-group">
                        <label>Pricing Info / URL</label>
                        <input type="text" id="vendorPricing"
                            placeholder="e.g., https://pricing.com or 'Call for price'">
                    </div>
                    <div class="form-group">
                        <label>Contact Name</label>
                        <input type="text" id="vendorContactName">
                    </div>
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" id="vendorContactEmail">
                    </div>
                    <div class="form-group">
                        <label>Contact Phone</label>
                        <input type="tel" id="vendorContactPhone">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn">Save Vendor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reply Query Modal -->
    <div id="replyModal" class="modal"
        style="display:none; position:fixed; z-index:1; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
        <div class="modal-content"
            style="background-color:#fefefe; margin:15% auto; padding:20px; border:1px solid #888; width:50%; border-radius:10px;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2>Reply to Query</h2>
                <span onclick="closeReplyModal()"
                    style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <p id="query-details" style="margin-bottom:1rem; color:#666;"></p>
                <form id="replyForm" onsubmit="sendReply(event)">
                    <input type="hidden" id="replyQueryId">
                    <div class="form-group">
                        <label>Your Reply</label>
                        <textarea id="replyMessage" rows="5"
                            style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;"
                            required></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn">Send Reply</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Log Communication Modal -->
    <div id="commModal" class="modal"
        style="display:none; position:fixed; z-index:1; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
        <div class="modal-content"
            style="background-color:#fefefe; margin:15% auto; padding:20px; border:1px solid #888; width:50%; border-radius:10px;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2>Log Vendor Communication</h2>
                <span onclick="closeCommModal()"
                    style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <form id="commForm" onsubmit="saveComm(event)">
                    <div class="form-group">
                        <label>Select Vendor</label>
                        <select id="commVendorId" required
                            style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Communication Type</label>
                        <select id="commType" required
                            style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;">
                            <option value="Email">Email</option>
                            <option value="Phone">Phone</option>
                            <option value="Meeting">Meeting</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes / Message</label>
                        <textarea id="commMessage" rows="5"
                            style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;"
                            required></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn">Log Communication</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Store Modal -->
    <div id="editStoreModal" class="modal"
        style="display:none; position:fixed; z-index:1; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.4);">
        <div class="modal-content"
            style="background-color:#fefefe; margin:10% auto; padding:20px; border:1px solid #888; width:60%; border-radius:10px;">
            <div class="modal-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2>Edit Store Details</h2>
                <span onclick="closeEditStoreModal()"
                    style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editStoreForm" onsubmit="saveStoreChanges(event)">
                    <input type="hidden" id="editStoreId">

                    <div class="form-group">
                        <label>Store Name</label>
                        <input type="text" id="editStoreName" disabled style="background:#eee;">
                    </div>

                    <div class="form-group">
                        <label>Store Status</label>
                        <select id="editStoreStatus"
                            style="width:100%; padding:10px; border-radius:5px; border:1px solid #ccc;">
                            <option value="Pending">Pending Approval</option>
                            <option value="Active">Active</option>
                            <option value="Suspended">Suspended</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Member ID (Owner)</label>
                        <input type="text" id="editMemberId" required>
                        <small style="color:#666;">Change this to re-assign the store to a different owner.</small>
                    </div>

                    <div class="form-group">
                        <label>Allowed Vendors</label>
                        <div id="editStoreVendors"
                            style="display:grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap:10px; margin-top:10px;">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="admin.js?v=1.2"></script>
</body>

</html>